<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speaking DAX - Lip Sync Test</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shrikhand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="settings">
        <div class="settings-panel">
            <div class="select-wrapper">
                <label for="audioSample">Audio Sample</label>
                <select id="audioSample">
                    <option value="v6" selected>Sample V6</option>
                    <option value="v5">Sample V5</option>
                    <option value="v2">Sample V2</option>
                    <option value="v3">Sample V3</option>
                    <option value="v4">Sample V4</option>
                    <option value="v1">Sample V1</option>
                </select>
            </div>
        </div>

        <div class="settings-panel">
            <div class="slider-wrapper">
                <label for="transitionSpeed">
                    Transition Speed
                    <span class="slider-value" id="transitionSpeedValue">50ms</span>
                </label>
                <input type="range" id="transitionSpeed" min="0" max="500" step="10" value="50">
            </div>
            <div class="slider-wrapper">
                <label for="anticipationTime">
                    Anticipation Time
                    <span class="slider-value" id="anticipationTimeValue">-20ms</span>
                </label>
                <input type="range" id="anticipationTime" min="-200" max="200" step="10" value="-20">
            </div>
        </div>
    </div>

    <div class="container">
        <div class="preview-grid">
            <div class="preview-box">
                <div class="mouth-container" id="mouthContainer">
                    <!-- For non-transition characters -->
                    <img id="mouthImage" src="" alt="Mouth Shape" style="display: none;">
                    
                    <!-- Embedded SVG for dax-transition character -->
                    <svg id="daxSvg" width="838" height="752" viewBox="0 0 838 752" fill="none" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; max-height: 100%; display: none;">
                        <g id="mouth-group">
                            <path id="tongue-path" d="M456.179 418.598C451.007 417.136 440.454 413.941 427.174 417.103C427.174 419.633 435.034 426.97 441.595 429.414C449.952 432.527 458.7 433.16 472.403 432.527C475.143 428.944 466.106 421.404 456.179 418.598Z" fill="#C61700"/>
                            <path id="upper-teeth-path" d="M469.165 414.46C457.451 414.439 427.827 409.978 419.391 407.883C412.475 406.164 415.67 414.307 421 417C426.33 419.693 435.856 422.551 451.5 425C467.144 427.449 492.088 429.622 495 425C497.912 420.378 501 413.222 495.847 413.222C492.722 413.222 480.878 414.48 469.165 414.46Z" fill="white"/>
                            <path id="lower-teeth-path" d="M502.071 392.394C507.713 390.516 508.427 387.333 508.5 384L426.5 384C426.5 384 411.615 386.253 416.5 388C419.974 389.243 431.266 391.158 445.881 392.894C466.288 395.318 491.671 395.855 502.071 392.394Z" fill="white"/>
                            <path id="beak-path" d="M464.5 365C439.04 366.426 380.5 355.5 380.5 395.499C380.5 415.499 392.5 429.485 430 435C488.441 443.594 556.857 415 566 383C568 376 524.954 396.596 508.5 400C479.5 406 434.5 406.041 434.5 403C434.5 399.5 477.283 405.234 515 393.5C537.5 386.5 583 370.999 574 349.5C568.767 337 530.5 361.303 464.5 365Z" fill="#FFCC33"/>
                        </g>
                    </svg>
                    
                    <!-- Eyes and Eyebrows Overlay -->
                    <svg id="eyesSvg" width="838" height="752" viewBox="0 0 838 752" fill="none" xmlns="http://www.w3.org/2000/svg" style="position: absolute; top: 0; left: 0; max-width: 100%; max-height: 100%; pointer-events: none; display: none;">
                        <path id="eye-left" opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M369.618 336.987C369.618 342.258 367.243 346.977 363.5 350.136C360.491 352.675 356.598 354.206 352.345 354.206C347.014 354.206 342.241 351.792 339.07 348C336.574 345.015 335.071 341.175 335.071 336.987C335.071 332.798 336.574 328.958 339.07 325.973C342.241 322.181 347.014 319.768 352.345 319.768C357.081 319.768 361.377 321.673 364.5 324.757C367.659 327.877 369.618 332.204 369.618 336.987Z" fill="#14307E"/>
                        <path id="eye-left-iris" d="M364.527 331.277C364.527 328.822 362.527 326.822 360.054 326.822C357.599 326.822 355.599 328.804 355.581 331.277C355.581 333.732 357.581 335.732 360.054 335.732C362.527 335.732 364.527 333.732 364.527 331.277Z" fill="white"/>
                        <path id="eye-brow-left" opacity="0.8" d="M334.416 288.201C343.671 284.333 350.945 284.833 356.087 286.05C357.17 286.306 357.922 285.141 357.056 284.442C353.065 281.223 344.132 277.226 332.482 281.571C322.089 285.446 317.191 293.497 317.162 298.791C317.155 300.038 319.722 300.144 320.386 299.088C322.179 296.235 325.161 292.069 334.416 288.201Z" fill="#14307E"/>
                        <path id="eye-right" opacity="0.8" fill-rule="evenodd" clip-rule="evenodd" d="M482 326.5C482 330.939 480.006 334.913 476.864 337.573C474.339 339.711 471.071 341 467.5 341C463.025 341 459.018 338.968 456.357 335.774C454.262 333.26 453 330.027 453 326.5C453 322.973 454.262 319.74 456.357 317.226C459.018 314.032 463.025 312 467.5 312C471.476 312 475.082 313.604 477.704 316.202C480.356 318.829 482 322.473 482 326.5Z" fill="#14307E"/>
                        <path id="eye-right-iris" d="M478.237 321.877C478.237 319.768 476.51 318.059 474.401 318.059C472.292 318.059 470.582 319.768 470.564 321.877C470.564 323.986 472.292 325.695 474.401 325.695C476.528 325.695 478.237 323.986 478.237 321.877Z" fill="white"/>
                        <path id="eye-brow-right" opacity="0.8" d="M441.723 282.698C444.349 278.398 450.173 275.078 459.705 275.078C469.236 275.078 473.72 278.871 476.824 283.1C477.455 283.96 476.499 284.973 475.519 284.55C475.284 284.448 475.045 284.344 474.803 284.238C471.317 282.715 467.037 280.846 459.705 280.742C451.862 280.63 446.917 282.594 443.803 284.287C442.754 284.857 441.1 283.718 441.723 282.698Z" fill="#14307E"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="play-button" id="playButton">
                ▶ Play Audio
            </button>
        </div>

        <div class="waveform-container">
            <div class="waveform-controls">
                <button id="zoomReset" class="zoom-btn">Reset Zoom</button>
                <span id="zoomLevel" class="zoom-indicator">Zoom: 1.0x</span>
                <span class="waveform-hint">Scroll to zoom • Drag to pan • +/- keys to zoom • 0 to reset</span>
            </div>
            <div class="waveform-display">
                <canvas id="waveformCanvas"></canvas>
                <div id="waveformOverlay">
                    <div id="playheadLine"></div>
                    <div id="phonemeMarkers"></div>
                </div>
            </div>
        </div>

        <div id="errorDisplay"></div>
    </div>

    <!-- Flubber library for smooth SVG path morphing -->
    <script src="https://unpkg.com/flubber@0.4.2"></script>
    <!-- Dax animation mouth shapes and morphing -->
    <script src="dax-animation.js"></script>
    <!-- Main application logic -->
    <script src="script.js"></script>
</body>
</html>

