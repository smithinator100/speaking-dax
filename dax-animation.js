// Dax Transition mouth shape paths
const daxMouthShapes = {
    'X': {
        tongue: "M456.179 418.598C451.007 417.136 440.454 413.941 427.174 417.103C427.174 419.633 435.034 426.97 441.595 429.414C449.952 432.527 458.7 433.16 472.403 432.527C475.143 428.944 466.106 421.404 456.179 418.598Z",
        upperTeeth: "M469.165 414.46C457.451 414.439 427.827 409.978 419.391 407.883C412.475 406.164 415.67 414.307 421 417C426.33 419.693 435.856 422.551 451.5 425C467.144 427.449 492.088 429.622 495 425C497.912 420.378 501 413.222 495.847 413.222C492.722 413.222 480.878 414.48 469.165 414.46Z",
        lowerTeeth: "M502.071 392.394C507.713 390.516 508.427 387.333 508.5 384L426.5 384C426.5 384 411.615 386.253 416.5 388C419.974 389.243 431.266 391.158 445.881 392.894C466.288 395.318 491.671 395.855 502.071 392.394Z",
        beak: "M464.5 365C439.04 366.426 380.5 355.5 380.5 395.499C380.5 415.499 392.5 429.485 430 435C488.441 443.594 556.857 415 566 383C568 376 524.954 396.596 508.5 400C479.5 406 434.5 406.041 434.5 403C434.5 399.5 477.283 405.234 515 393.5C537.5 386.5 583 370.999 574 349.5C568.767 337 530.5 361.303 464.5 365Z"
    },
    'A': {
        tongue: "M456.179 418.598C451.007 417.136 440.454 413.941 427.174 417.103C427.174 419.633 435.034 426.97 441.594 429.414C449.952 432.527 458.7 433.16 472.402 432.527C475.143 428.944 466.106 421.404 456.179 418.598Z",
        upperTeeth: "M469.165 417.46C457.451 417.439 427.827 412.978 419.391 410.883C412.475 409.164 415.67 417.307 421 420C426.33 422.693 435.856 425.551 451.5 428C467.144 430.449 492.088 432.622 495 428C497.912 423.378 501 416.222 495.847 416.222C492.722 416.222 480.879 417.48 469.165 417.46Z",
        lowerTeeth: "M502.071 395.394C507.713 393.516 508.427 390.333 508.5 387L426.5 387C426.5 387 411.615 389.253 416.5 391C419.974 392.243 431.266 394.158 445.881 395.894C466.288 398.318 491.671 398.855 502.071 395.394Z",
        beak: "M411.5 375C389.5 377.5 379.81 389.683 381.5 407C383.5 427.5 410.532 435.37 430.5 436.5C457 438 505 428.5 505 428.5C505 428.5 551 420.5 551 407C551 403.48 549.5 398.742 547 398.5C531.5 397 513.773 399.954 492.5 403.5C465.5 408 455.5 411.5 426.5 411C424.141 410.959 422 410.5 422 409C422 407.5 423.141 406.931 425.5 407C442.5 407.5 467.399 404.669 492.5 400C514 396 526.5 392.5 547 394C551.515 394.33 566.368 376.595 561 366C556.138 356.406 545.689 358.312 535 359.5C490 364.5 459.797 369.512 411.5 375Z"
    },
    'B': {
        tongue: "M456.179 418.598C451.007 417.136 440.454 413.941 427.174 417.103C427.174 419.633 435.034 426.97 441.594 429.414C449.952 432.527 458.7 433.16 472.402 432.527C475.143 428.944 466.106 421.404 456.179 418.598Z",
        upperTeeth: "M469.165 406.46C457.451 406.439 427.827 401.978 419.391 399.883C412.475 398.164 415.67 406.307 421 409C426.33 411.693 435.856 414.551 451.5 417C467.144 419.449 492.088 421.622 495 417C497.912 412.378 501 405.222 495.847 405.222C492.722 405.222 480.879 406.48 469.165 406.46Z",
        lowerTeeth: "M502.071 400.394C507.713 398.516 508.427 395.333 508.5 392L426.5 392C426.5 392 411.615 394.253 416.5 396C419.974 397.243 431.266 399.158 445.881 400.894C466.288 403.318 491.671 403.855 502.071 400.394Z",
        beak: "M434.7 367.387C403.026 363.069 378.916 372.584 378.916 394.084C378.916 414.084 398.918 424.699 419.228 433.429C471.162 455.752 563.437 433 554.5 413.5C551.75 407.5 510.859 413.354 494.156 415.187C456.948 419.271 407.236 405.189 420.969 396.213C429.402 390.702 478.98 401.426 518 392.5C536.354 388.302 579.304 374.927 574 350C571.07 336.229 521.816 379.266 434.7 367.387Z"
    },
    'C': {
        tongue: "M456.179 418.598C451.007 417.136 440.454 413.941 427.174 417.103C427.174 419.633 435.034 426.97 441.594 429.414C449.952 432.527 458.7 433.16 472.402 432.527C475.143 428.944 466.106 421.404 456.179 418.598Z",
        upperTeeth: "M469.165 430.46C457.451 430.439 427.827 425.978 419.391 423.883C412.475 422.164 415.67 430.307 421 433C426.33 435.693 435.856 438.551 451.5 441C467.144 443.449 492.088 445.622 495 441C497.912 436.378 501 429.222 495.847 429.222C492.722 429.222 480.879 430.48 469.165 430.46Z",
        lowerTeeth: "M502.071 400.394C507.713 398.516 508.427 395.333 508.5 392L426.5 392C426.5 392 411.615 394.253 416.5 396C419.974 397.243 431.266 399.158 445.881 400.894C466.288 403.318 491.671 403.855 502.071 400.394Z",
        beak: "M382.058 396.704C384.401 386.449 395.396 367.346 434.615 367.603C454.441 367.733 479.07 367.595 495.398 365.74C519.666 362.983 535.003 358.657 547.005 354.079C563.983 347.605 570.006 349.047 572.118 352.922C574.439 357.18 571.704 364.533 565.773 371.302C554.442 384.23 532.267 393.077 500.776 395.68C464.802 398.653 440.93 388.051 430.671 403.762C426.247 410.538 427.136 425.896 462.195 428.44C511.037 431.983 542.235 419.405 547.005 428.44C551.776 437.474 526.973 455.857 479.886 456.242C432.799 456.627 410.081 445.268 399.651 436.882C386.418 426.242 378.993 410.119 382.058 396.704Z"
    },
    'D': {
        tongue: "M453.395 432.38C448.223 430.919 437.67 427.724 424.389 430.886C424.389 433.415 432.218 443.5 438.779 445.944C447.136 449.057 455.89 452.703 469.592 452.07C471.935 445.583 463.321 435.186 453.395 432.38Z",
        upperTeeth: "M469.165 456.46C457.451 456.439 427.827 451.978 419.391 449.883C412.475 448.164 415.67 456.307 421 459C426.33 461.693 435.856 464.551 451.5 467C467.144 469.449 492.088 471.622 495 467C497.912 462.378 501 455.222 495.847 455.222C492.722 455.222 480.879 456.48 469.165 456.46Z",
        lowerTeeth: "M502.071 400.394C507.713 398.516 508.427 395.333 508.5 392L426.5 392C426.5 392 411.615 394.253 416.5 396C419.974 397.243 431.266 399.158 445.881 400.894C466.288 403.318 491.671 403.855 502.071 400.394Z",
        beak: "M437.659 366.29C419.915 367.933 392.97 369.247 384.427 397.506C369.395 447.225 427.69 479.371 480.19 479.371C507.393 479.371 540.84 467.338 537.281 451.769C535.317 443.175 511.012 452.697 481.937 451.769C449.553 450.736 421.886 438.58 427.144 414.264C431.842 392.537 456.593 396.395 502 394C545.548 391.704 583.022 371.342 573.572 350.341C568.309 338.648 533.783 357.372 506.093 360.931C476.237 364.769 464.821 363.775 437.659 366.29Z"
    },
    'E': {
        tongue: "M458.604 423.036C453.242 422.662 435.085 420.217 422.73 426.027C423.247 428.503 440.147 438.249 447.068 439.3C455.886 440.64 465.2 442.419 478.484 439C479.451 432.171 468.895 423.754 458.604 423.036Z",
        upperTeeth: "M469.165 440.46C457.451 440.439 427.827 435.978 419.391 433.883C412.475 432.164 415.67 440.307 421 443C426.33 445.693 435.856 448.551 451.5 451C467.144 453.449 492.088 455.622 495 451C497.912 446.378 501 439.222 495.847 439.222C492.722 439.222 480.879 440.48 469.165 440.46Z",
        lowerTeeth: "M502.071 384.394C507.713 382.516 508.427 379.333 508.5 376L426.5 376C426.5 376 411.615 378.253 416.5 380C419.974 381.243 431.266 383.158 445.881 384.894C466.288 387.318 491.671 387.855 502.071 384.394Z",
        beak: "M390.114 399.21C392.457 388.955 401.836 367.633 440.788 363.052C469.088 359.724 483.381 359.504 512.101 355.86C532.381 353.288 548.359 348.593 552.216 355.861C558.397 367.507 548.035 377.912 537.316 380.974C521.27 385.559 515.183 385.075 483.693 387.678C447.719 390.651 436.678 388.458 429.724 403.385C426.307 410.721 423.416 428.966 467.755 435.974C498.557 440.842 514.494 429.82 519.264 438.855C524.035 447.89 505.643 462.96 474.851 463.211C444.058 463.463 425.378 457.982 407.495 443.604C394.262 432.964 387.048 412.625 390.114 399.21Z"
    },
    'F': {
        tongue: "M456.179 418.598C451.007 417.136 440.454 413.941 427.174 417.103C427.174 419.633 435.034 426.97 441.595 429.414C449.952 432.527 458.7 433.16 472.403 432.527C475.143 428.944 466.106 421.404 456.179 418.598Z",
        upperTeeth: "M469.165 416.46C457.451 416.439 427.827 411.978 419.391 409.883C412.475 408.164 415.67 416.307 421 419C426.33 421.693 435.856 424.551 451.5 427C467.144 429.449 492.088 431.622 495 427C497.912 422.378 501 415.222 495.847 415.222C492.722 415.222 480.878 416.48 469.165 416.46Z",
        lowerTeeth: "M502.071 391.394C507.713 389.516 508.427 386.333 508.5 383L426.5 383C426.5 383 411.615 385.253 416.5 387C419.974 388.243 431.266 390.158 445.881 391.894C466.288 394.318 491.671 394.855 502.071 391.394Z",
        beak: "M472.59 366.561C438.09 365.061 404.985 371.164 400.524 402.203C397.81 421.084 410.238 443.816 445.212 448.651C470.69 452.172 490.951 440.552 505.814 427.417C511.774 422.15 529.405 412.245 541.4 411.228C562.514 409.438 558.127 383.065 539.5 388C514.5 394.624 520.609 391.115 543.5 382C559.204 375.747 558.217 350.968 545.369 356.084C513.648 368.715 484.079 367.06 472.59 366.561Z"
    },
    'G': {
        tongue: "M456.179 418.598C451.007 417.136 440.454 413.941 427.174 417.103C427.174 419.633 435.034 426.97 441.595 429.414C449.952 432.527 458.7 433.16 472.403 432.527C475.143 428.944 466.106 421.404 456.179 418.598Z",
        upperTeeth: "M468.365 390.332C456.835 392.398 426.89 393.285 418.216 392.726C411.104 392.268 415.698 399.711 421.423 401.411C427.147 403.112 437.03 404.227 452.86 403.85C468.69 403.473 493.622 401.168 495.664 396.101C497.706 391.034 499.47 383.442 494.4 384.36C491.325 384.917 479.895 388.265 468.365 390.332Z",
        lowerTeeth: "M502.071 386.394C507.713 384.516 508.427 381.333 508.5 378L426.5 378C426.5 378 411.615 380.253 416.5 382C419.974 383.243 431.266 385.158 445.881 386.894C466.288 389.318 491.671 389.855 502.071 386.394Z",
        beak: "M482 364.5C456.632 367.092 379.5 355 378 398.5C377.311 418.488 383.839 441.22 421.5 445.5C465.5 450.5 520.857 426 530 394C532 387 479.954 390.096 463.5 393.5C434.5 399.5 433.5 400.5 433.5 397.5C433.5 394 496.914 385.727 515 387.5C540.5 390 578.261 376.696 574 349C572 335.999 550.5 357.5 482 364.5Z"
    },
    'H': {
        tongue: "M464.5 414C454.555 420.914 435.5 425 435.5 425C435.5 425 470 440.5 484 416C487.832 409.293 491.344 401.896 484 399.5C475.599 396.759 471.755 408.956 464.5 414Z",
        upperTeeth: "M469.165 430.46C457.451 430.439 427.827 425.978 419.391 423.883C412.475 422.164 415.67 430.307 421 433C426.33 435.693 435.856 438.551 451.5 441C467.144 443.449 492.088 445.622 495 441C497.912 436.378 501 429.222 495.847 429.222C492.722 429.222 480.878 430.48 469.165 430.46Z",
        lowerTeeth: "M502.071 400.394C507.713 398.516 508.427 395.333 508.5 392L426.5 392C426.5 392 411.615 394.253 416.5 396C419.974 397.243 431.266 399.158 445.881 400.894C466.288 403.318 491.671 403.855 502.071 400.394Z",
        beak: "M382.058 396.704C384.401 386.449 395.396 367.346 434.615 367.603C454.442 367.733 479.07 367.595 495.398 365.74C519.666 362.983 535.003 358.657 547.006 354.079C563.983 347.605 570.006 349.047 572.119 352.922C574.439 357.18 571.705 364.533 565.773 371.302C554.442 384.23 532.267 393.077 500.777 395.68C464.802 398.653 440.931 388.051 430.671 403.762C426.247 410.538 427.136 425.896 462.195 428.44C511.037 431.983 542.235 419.405 547.006 428.44C551.776 437.474 526.973 455.857 479.886 456.242C432.799 456.627 410.081 445.268 399.651 436.882C386.418 426.242 378.993 410.119 382.058 396.704Z"
    }
};

// Morph SVG mouth to new shape (all 4 paths)
function morphBeak(fromShape, toShape, duration, tonguePath, upperTeethPath, lowerTeethPath, beakPath, currentMorphAnimation) {
    const fromShapeData = daxMouthShapes[fromShape];
    const toShapeData = daxMouthShapes[toShape];
    
    if (!fromShapeData || !toShapeData) return null;

    // Cancel any existing animation
    if (currentMorphAnimation) {
        cancelAnimationFrame(currentMorphAnimation);
    }

    try {
        // Create interpolators for all 4 paths using Flubber
        const tongueInterpolator = flubber.interpolate(fromShapeData.tongue, toShapeData.tongue);
        const upperTeethInterpolator = flubber.interpolate(fromShapeData.upperTeeth, toShapeData.upperTeeth);
        const lowerTeethInterpolator = flubber.interpolate(fromShapeData.lowerTeeth, toShapeData.lowerTeeth);
        const beakInterpolator = flubber.interpolate(fromShapeData.beak, toShapeData.beak);
        
        const startTime = performance.now();
        let animationId = null;
        
        function animate(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // Ease-in-out function for smoother animation
            const eased = progress < 0.5
                ? 2 * progress * progress
                : 1 - Math.pow(-2 * progress + 2, 2) / 2;
            
            // Update all 4 paths
            tonguePath.setAttribute('d', tongueInterpolator(eased));
            upperTeethPath.setAttribute('d', upperTeethInterpolator(eased));
            lowerTeethPath.setAttribute('d', lowerTeethInterpolator(eased));
            beakPath.setAttribute('d', beakInterpolator(eased));
            
            if (progress < 1) {
                animationId = requestAnimationFrame(animate);
            } else {
                animationId = null;
            }
        }
        
        animationId = requestAnimationFrame(animate);
        return animationId;
    } catch (error) {
        console.error('Morph error:', error);
        // Fallback to instant change
        tonguePath.setAttribute('d', toShapeData.tongue);
        upperTeethPath.setAttribute('d', toShapeData.upperTeeth);
        lowerTeethPath.setAttribute('d', toShapeData.lowerTeeth);
        beakPath.setAttribute('d', toShapeData.beak);
        return null;
    }
}

// Reset mouth to neutral position
function resetMouthToNeutral(tonguePath, upperTeethPath, lowerTeethPath, beakPath) {
    tonguePath.setAttribute('d', daxMouthShapes['X'].tongue);
    upperTeethPath.setAttribute('d', daxMouthShapes['X'].upperTeeth);
    lowerTeethPath.setAttribute('d', daxMouthShapes['X'].lowerTeeth);
    beakPath.setAttribute('d', daxMouthShapes['X'].beak);
}


